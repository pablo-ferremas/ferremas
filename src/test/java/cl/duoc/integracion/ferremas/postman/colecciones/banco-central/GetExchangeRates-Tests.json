{
  "info": {
    "name": "GetExchangeRates-Tests",
    "description": "Pruebas para el endpoint GET /api/v1/tasas del BancoCentralController",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "GET - Obtener tasas de cambio exitoso",
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "Accept",
            "value": "application/json"
          }
        ],
        "url": {
          "raw": "{{base_url}}/{{api_version}}/{{banco_central_endpoint}}",
          "host": ["{{base_url}}"],
          "path": ["{{api_version}}", "{{banco_central_endpoint}}"]
        },
        "description": "Prueba exitosa para obtener las tasas de cambio actuales del Banco Central"
      },
      "response": [],
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "// Verificar que la respuesta sea exitosa",
              "pm.test(\"Status code is 200\", function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "// Verificar que la respuesta sea un array",
              "pm.test(\"Response is an array\", function () {",
              "    const response = pm.response.json();",
              "    pm.expect(response).to.be.an('array');",
              "});",
              "",
              "// Verificar estructura de la respuesta",
              "pm.test(\"Response has correct structure\", function () {",
              "    const response = pm.response.json();",
              "    if (response.length > 0) {",
              "        const firstRate = response[0];",
              "        pm.expect(firstRate).to.have.property('currency');",
              "        pm.expect(firstRate).to.have.property('rate');",
              "        pm.expect(firstRate).to.have.property('date');",
              "    }",
              "});",
              "",
              "// Verificar tipos de datos",
              "pm.test(\"Data types are correct\", function () {",
              "    const response = pm.response.json();",
              "    if (response.length > 0) {",
              "        const firstRate = response[0];",
              "        pm.expect(firstRate.currency).to.be.a('string');",
              "        pm.expect(firstRate.rate).to.be.a('number');",
              "        pm.expect(firstRate.date).to.be.a('string');",
              "    }",
              "});",
              "",
              "// Verificar que las monedas sean válidas",
              "pm.test(\"Currencies are valid\", function () {",
              "    const response = pm.response.json();",
              "    const validCurrencies = ['USD', 'EUR'];",
              "    response.forEach(rate => {",
              "        pm.expect(validCurrencies).to.include(rate.currency);",
              "    });",
              "});",
              "",
              "// Verificar que las tasas sean positivas",
              "pm.test(\"Rates are positive\", function () {",
              "    const response = pm.response.json();",
              "    response.forEach(rate => {",
              "        pm.expect(rate.rate).to.be.above(0);",
              "    });",
              "});",
              "",
              "// Verificar tiempo de respuesta",
              "pm.test(\"Response time is less than 5000ms\", function () {",
              "    pm.expect(pm.response.responseTime).to.be.below(5000);",
              "});",
              "",
              "// Verificar headers de respuesta",
              "pm.test(\"Response has correct headers\", function () {",
              "    pm.expect(pm.response.headers.get('Content-Type')).to.include('application/json');",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ]
    },
    {
      "name": "GET - Obtener tasas con Accept header específico",
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Accept",
            "value": "application/json, text/plain, */*"
          }
        ],
        "url": {
          "raw": "{{base_url}}/{{api_version}}/{{banco_central_endpoint}}",
          "host": ["{{base_url}}"],
          "path": ["{{api_version}}", "{{banco_central_endpoint}}"]
        },
        "description": "Prueba con header Accept específico para verificar compatibilidad"
      },
      "response": [],
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test(\"Response is valid JSON\", function () {",
              "    const response = pm.response.json();",
              "    pm.expect(response).to.be.an('array');",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ]
    },
    {
      "name": "GET - Obtener tasas sin headers",
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{base_url}}/{{api_version}}/{{banco_central_endpoint}}",
          "host": ["{{base_url}}"],
          "path": ["{{api_version}}", "{{banco_central_endpoint}}"]
        },
        "description": "Prueba sin headers para verificar comportamiento por defecto"
      },
      "response": [],
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test(\"Response is valid JSON\", function () {",
              "    const response = pm.response.json();",
              "    pm.expect(response).to.be.an('array');",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ]
    },
    {
      "name": "GET - Obtener tasas con User-Agent personalizado",
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "User-Agent",
            "value": "PostmanRuntime/7.32.3"
          },
          {
            "key": "Accept",
            "value": "application/json"
          }
        ],
        "url": {
          "raw": "{{base_url}}/{{api_version}}/{{banco_central_endpoint}}",
          "host": ["{{base_url}}"],
          "path": ["{{api_version}}", "{{banco_central_endpoint}}"]
        },
        "description": "Prueba con User-Agent personalizado para verificar compatibilidad"
      },
      "response": [],
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test(\"Response is valid JSON\", function () {",
              "    const response = pm.response.json();",
              "    pm.expect(response).to.be.an('array');",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ]
    },
    {
      "name": "GET - Obtener tasas con Cache-Control",
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Cache-Control",
            "value": "no-cache"
          },
          {
            "key": "Accept",
            "value": "application/json"
          }
        ],
        "url": {
          "raw": "{{base_url}}/{{api_version}}/{{banco_central_endpoint}}",
          "host": ["{{base_url}}"],
          "path": ["{{api_version}}", "{{banco_central_endpoint}}"]
        },
        "description": "Prueba con Cache-Control para verificar comportamiento de caché"
      },
      "response": [],
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test(\"Response is valid JSON\", function () {",
              "    const response = pm.response.json();",
              "    pm.expect(response).to.be.an('array');",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ]
    },
    {
      "name": "GET - Obtener tasas con Accept-Language",
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Accept-Language",
            "value": "es-ES,es;q=0.9,en;q=0.8"
          },
          {
            "key": "Accept",
            "value": "application/json"
          }
        ],
        "url": {
          "raw": "{{base_url}}/{{api_version}}/{{banco_central_endpoint}}",
          "host": ["{{base_url}}"],
          "path": ["{{api_version}}", "{{banco_central_endpoint}}"]
        },
        "description": "Prueba con Accept-Language para verificar internacionalización"
      },
      "response": [],
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test(\"Response is valid JSON\", function () {",
              "    const response = pm.response.json();",
              "    pm.expect(response).to.be.an('array');",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ]
    },
    {
      "name": "GET - Obtener tasas con Authorization header (debe fallar)",
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer invalid-token"
          },
          {
            "key": "Accept",
            "value": "application/json"
          }
        ],
        "url": {
          "raw": "{{base_url}}/{{api_version}}/{{banco_central_endpoint}}",
          "host": ["{{base_url}}"],
          "path": ["{{api_version}}", "{{banco_central_endpoint}}"]
        },
        "description": "Prueba con Authorization header inválido - debe funcionar ya que el endpoint no requiere autenticación"
      },
      "response": [],
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200 (no auth required)\", function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test(\"Response is valid JSON\", function () {",
              "    const response = pm.response.json();",
              "    pm.expect(response).to.be.an('array');",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ]
    },
    {
      "name": "GET - Obtener tasas con Content-Type incorrecto",
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Content-Type",
            "value": "text/plain"
          },
          {
            "key": "Accept",
            "value": "application/json"
          }
        ],
        "url": {
          "raw": "{{base_url}}/{{api_version}}/{{banco_central_endpoint}}",
          "host": ["{{base_url}}"],
          "path": ["{{api_version}}", "{{banco_central_endpoint}}"]
        },
        "description": "Prueba con Content-Type incorrecto - debe funcionar ya que es GET"
      },
      "response": [],
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test(\"Response is valid JSON\", function () {",
              "    const response = pm.response.json();",
              "    pm.expect(response).to.be.an('array');",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ]
    },
    {
      "name": "GET - Obtener tasas con Accept XML (debe fallar)",
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Accept",
            "value": "application/xml"
          }
        ],
        "url": {
          "raw": "{{base_url}}/{{api_version}}/{{banco_central_endpoint}}",
          "host": ["{{base_url}}"],
          "path": ["{{api_version}}", "{{banco_central_endpoint}}"]
        },
        "description": "Prueba solicitando XML - debe devolver JSON ya que solo soporta JSON"
      },
      "response": [],
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test(\"Response is still JSON\", function () {",
              "    const response = pm.response.json();",
              "    pm.expect(response).to.be.an('array');",
              "});",
              "",
              "pm.test(\"Content-Type is application/json\", function () {",
              "    pm.expect(pm.response.headers.get('Content-Type')).to.include('application/json');",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ]
    },
    {
      "name": "GET - Obtener tasas con Accept */*",
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Accept",
            "value": "*/*"
          }
        ],
        "url": {
          "raw": "{{base_url}}/{{api_version}}/{{banco_central_endpoint}}",
          "host": ["{{base_url}}"],
          "path": ["{{api_version}}", "{{banco_central_endpoint}}"]
        },
        "description": "Prueba con Accept */* para verificar comportamiento por defecto"
      },
      "response": [],
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test(\"Response is valid JSON\", function () {",
              "    const response = pm.response.json();",
              "    pm.expect(response).to.be.an('array');",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ]
    },
    {
      "name": "GET - Obtener tasas con If-Modified-Since",
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "If-Modified-Since",
            "value": "Wed, 21 Oct 2023 07:28:00 GMT"
          },
          {
            "key": "Accept",
            "value": "application/json"
          }
        ],
        "url": {
          "raw": "{{base_url}}/{{api_version}}/{{banco_central_endpoint}}",
          "host": ["{{base_url}}"],
          "path": ["{{api_version}}", "{{banco_central_endpoint}}"]
        },
        "description": "Prueba con If-Modified-Since para verificar comportamiento de caché condicional"
      },
      "response": [],
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test(\"Response is valid JSON\", function () {",
              "    const response = pm.response.json();",
              "    pm.expect(response).to.be.an('array');",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ]
    },
    {
      "name": "GET - Obtener tasas con If-None-Match",
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "If-None-Match",
            "value": "\"abc123\""
          },
          {
            "key": "Accept",
            "value": "application/json"
          }
        ],
        "url": {
          "raw": "{{base_url}}/{{api_version}}/{{banco_central_endpoint}}",
          "host": ["{{base_url}}"],
          "path": ["{{api_version}}", "{{banco_central_endpoint}}"]
        },
        "description": "Prueba con If-None-Match para verificar comportamiento de ETag"
      },
      "response": [],
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test(\"Response is valid JSON\", function () {",
              "    const response = pm.response.json();",
              "    pm.expect(response).to.be.an('array');",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ]
    },
    {
      "name": "GET - Obtener tasas con X-Requested-With",
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "X-Requested-With",
            "value": "XMLHttpRequest"
          },
          {
            "key": "Accept",
            "value": "application/json"
          }
        ],
        "url": {
          "raw": "{{base_url}}/{{api_version}}/{{banco_central_endpoint}}",
          "host": ["{{base_url}}"],
          "path": ["{{api_version}}", "{{banco_central_endpoint}}"]
        },
        "description": "Prueba con X-Requested-With para simular petición AJAX"
      },
      "response": [],
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test(\"Response is valid JSON\", function () {",
              "    const response = pm.response.json();",
              "    pm.expect(response).to.be.an('array');",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ]
    },
    {
      "name": "GET - Obtener tasas con Origin header",
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Origin",
            "value": "https://example.com"
          },
          {
            "key": "Accept",
            "value": "application/json"
          }
        ],
        "url": {
          "raw": "{{base_url}}/{{api_version}}/{{banco_central_endpoint}}",
          "host": ["{{base_url}}"],
          "path": ["{{api_version}}", "{{banco_central_endpoint}}"]
        },
        "description": "Prueba con Origin header para verificar CORS"
      },
      "response": [],
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test(\"Response is valid JSON\", function () {",
              "    const response = pm.response.json();",
              "    pm.expect(response).to.be.an('array');",
              "});",
              "",
              "pm.test(\"CORS headers are present\", function () {",
              "    pm.expect(pm.response.headers.get('Access-Control-Allow-Origin')).to.exist;",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ]
    },
    {
      "name": "GET - Obtener tasas con Referer header",
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Referer",
            "value": "https://example.com/dashboard"
          },
          {
            "key": "Accept",
            "value": "application/json"
          }
        ],
        "url": {
          "raw": "{{base_url}}/{{api_version}}/{{banco_central_endpoint}}",
          "host": ["{{base_url}}"],
          "path": ["{{api_version}}", "{{banco_central_endpoint}}"]
        },
        "description": "Prueba con Referer header para verificar comportamiento"
      },
      "response": [],
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test(\"Response is valid JSON\", function () {",
              "    const response = pm.response.json();",
              "    pm.expect(response).to.be.an('array');",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ]
    },
    {
      "name": "GET - Obtener tasas con múltiples headers",
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Accept",
            "value": "application/json"
          },
          {
            "key": "User-Agent",
            "value": "PostmanRuntime/7.32.3"
          },
          {
            "key": "Cache-Control",
            "value": "no-cache"
          },
          {
            "key": "Accept-Language",
            "value": "es-ES,es;q=0.9"
          },
          {
            "key": "X-Requested-With",
            "value": "XMLHttpRequest"
          }
        ],
        "url": {
          "raw": "{{base_url}}/{{api_version}}/{{banco_central_endpoint}}",
          "host": ["{{base_url}}"],
          "path": ["{{api_version}}", "{{banco_central_endpoint}}"]
        },
        "description": "Prueba con múltiples headers para verificar comportamiento complejo"
      },
      "response": [],
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test(\"Response is valid JSON\", function () {",
              "    const response = pm.response.json();",
              "    pm.expect(response).to.be.an('array');",
              "});",
              "",
              "pm.test(\"Response has correct structure\", function () {",
              "    const response = pm.response.json();",
              "    if (response.length > 0) {",
              "        const firstRate = response[0];",
              "        pm.expect(firstRate).to.have.property('currency');",
              "        pm.expect(firstRate).to.have.property('rate');",
              "        pm.expect(firstRate).to.have.property('date');",
              "    }",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ]
    }
  ],
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Script de pre-request común para todas las pruebas",
          "console.log('Iniciando prueba para endpoint de tasas de cambio');"
        ]
      }
    },
    {
      "listen": "test",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Script de test común para todas las pruebas",
          "console.log('Completando prueba para endpoint de tasas de cambio');"
        ]
      }
    }
  ],
  "variable": [
    {
      "key": "base_url",
      "value": "{{base_url}}",
      "type": "string"
    },
    {
      "key": "api_version",
      "value": "{{api_version}}",
      "type": "string"
    },
    {
      "key": "banco_central_endpoint",
      "value": "{{banco_central_endpoint}}",
      "type": "string"
    }
  ]
} 