import{a as G}from"./chunk-I2XG45E3.js";import{b as j}from"./chunk-OV6FUWXQ.js";import{$ as _,$a as N,Ab as B,Ca as v,Ha as O,Ma as p,Sa as y,Sb as M,Ta as s,Tb as F,Ub as H,Va as f,Wa as D,Wb as z,Xa as i,Ya as a,Za as g,_ as b,_a as A,ab as C,bb as x,bc as L,cb as c,db as h,dc as V,hb as w,ib as r,jb as m,kb as E,lb as S,tb as R,va as P,wb as I,xb as T,ya as o,yb as k}from"./chunk-TVOLU7LP.js";var $=()=>[];function K(l,n){l&1&&(i(0,"div",11)(1,"div",12)(2,"span",13),r(3,"Cargando..."),a()(),i(4,"p",14),r(5,"Cargando pedidos..."),a()())}function X(l,n){if(l&1&&(i(0,"div",15),r(1),a()),l&2){let e=c();o(),m(e.error)}}function q(l,n){if(l&1&&(A(0),i(1,"ul",25)(2,"li"),g(3,"img",26),i(4,"strong"),r(5),a(),r(6),g(7,"br"),i(8,"small"),r(9),a()()(),N()),l&2){let e=c().$implicit;o(3),h("alt",e.items[0].nombreProducto),s("src",e.items[0].imagenProducto,P),o(2),m(e.items[0].nombreProducto),o(),E(" (x",e.items[0].cantidad,")"),o(3),E("SKU: ",e.items[0].skuProducto,"")}}function J(l,n){if(l&1&&(i(0,"li"),g(1,"img",26),i(2,"strong"),r(3),a(),r(4),g(5,"br"),i(6,"small"),r(7),a()()),l&2){let e=n.$implicit;o(),h("alt",e.nombreProducto),s("src",e.imagenProducto,P),o(2),m(e.nombreProducto),o(),E(" (x",e.cantidad,")"),o(3),E("SKU: ",e.skuProducto,"")}}function Q(l,n){if(l&1&&(i(0,"button",27),r(1),a(),i(2,"div",28)(3,"ul",25),p(4,J,8,5,"li",18),a()()),l&2){let e=c().$implicit;y("data-bs-target","#detalleItems"+e.id),o(),E(" Detalle (",e.items.length,") "),o(),s("id","detalleItems"+e.id),o(2),s("ngForOf",e.items)}}function W(l,n){if(l&1){let e=C();i(0,"tr")(1,"td"),r(2),a(),i(3,"td")(4,"span"),r(5),a()(),i(6,"td"),r(7),I(8,"date"),a(),i(9,"td"),r(10),a(),i(11,"td"),r(12),a(),i(13,"td"),r(14),a(),i(15,"td"),r(16),g(17,"br"),r(18),a(),i(19,"td"),r(20),I(21,"conversor"),a(),i(22,"td"),p(23,q,10,5,"ng-container",19)(24,Q,5,4,"ng-template",null,0,B),a(),i(26,"td")(27,"div",20)(28,"button",21),x("click",function(){let d=b(e).$implicit,u=c(2);return _(u.marcarComoListo(d))}),g(29,"i",22),a(),i(30,"button",23),x("click",function(){let d=b(e).$implicit,u=c(2);return _(u.confirmarRecepcion(d))}),g(31,"i",24),a()()()()}if(l&2){let e=n.$implicit,t=w(25),d=c(2);o(2),m(e.numeroOrden),o(2),D(d.obtenerClaseEstado(e.estado)),o(),m(d.traducirEstado(e.estado).toUpperCase()),o(2),m(k(8,18,e.fechaCreacion,"short")),o(3),m(e.usuario==null?null:e.usuario.nombre),o(2),m(e.usuario==null?null:e.usuario.email),o(2),m(e.usuario==null?null:e.usuario.telefono),o(2),S(" ",e.direccionEntrega==null?null:e.direccionEntrega.calle," ",e.direccionEntrega==null?null:e.direccionEntrega.numero,""),o(2),S(" ",e.direccionEntrega==null?null:e.direccionEntrega.nombreComuna,", ",e.direccionEntrega==null?null:e.direccionEntrega.nombreRegion," "),o(2),m(T(21,21,e.total)),o(3),s("ngIf",e.items.length===1)("ngIfElse",t),o(5),s("title",e.estado==="DESPACHADO"?"Pedido ya despachado":"Despachar pedido")("disabled",e.estado==="DESPACHADO"||e.estado==="ENTREGADO"),o(2),s("disabled",e.estado!=="DESPACHADO")}}function Y(l,n){if(l&1&&(i(0,"table",16)(1,"thead",17)(2,"tr")(3,"th"),r(4,"N\xB0 Orden"),a(),i(5,"th"),r(6,"Estado"),a(),i(7,"th"),r(8,"Fecha"),a(),i(9,"th"),r(10,"Cliente"),a(),i(11,"th"),r(12,"Email"),a(),i(13,"th"),r(14,"Tel\xE9fono"),a(),i(15,"th"),r(16,"Direcci\xF3n"),a(),i(17,"th"),r(18,"Total"),a(),i(19,"th"),r(20,"Items"),a(),i(21,"th"),r(22,"Acciones"),a()()(),i(23,"tbody"),p(24,W,32,23,"tr",18),a()()),l&2){let e=c();o(24),s("ngForOf",e.pagedPedidos)}}function Z(l,n){if(l&1){let e=C();i(0,"li",31)(1,"button",34),x("click",function(){let d=b(e).index,u=c(2);return _(u.setPage(d+1))}),r(2),a()()}if(l&2){let e=n.index,t=c(2);f("active",t.currentPage===e+1),o(2),m(e+1)}}function ee(l,n){if(l&1){let e=C();i(0,"nav",29)(1,"ul",30)(2,"li",31)(3,"button",32),x("click",function(){b(e);let d=c();return _(d.setPage(d.currentPage-1))}),r(4,"\xAB"),a()(),p(5,Z,3,3,"li",33),i(6,"li",31)(7,"button",32),x("click",function(){b(e);let d=c();return _(d.setPage(d.currentPage+1))}),r(8,"\xBB"),a()()()()}if(l&2){let e=c();o(2),f("disabled",e.currentPage===1),o(),s("disabled",e.currentPage===1),o(2),s("ngForOf",R(7,$).constructor(e.totalPages)),o(),f("disabled",e.currentPage===e.totalPages),o(),s("disabled",e.currentPage===e.totalPages)}}function te(l,n){l&1&&(i(0,"div",35),r(1," No hay pedidos en preparaci\xF3n. "),a())}var U=class l{constructor(n,e){this.http=n;this.pedidoService=e}pedidos=[];isLoading=!0;error="";currentPage=1;pageSize=10;get totalPages(){return Math.ceil(this.pedidos.length/this.pageSize)}get pagedPedidos(){let n=(this.currentPage-1)*this.pageSize;return this.pedidos.slice(n,n+this.pageSize)}ngOnInit(){this.http.get(`${V.apiUrl}/pedidos`).subscribe({next:n=>{let e=n.filter(t=>t.estado==="EN_PREPARACION"||t.estado==="DESPACHADO"||t.estado==="ENTREGADO");this.pedidos=e.sort((t,d)=>{let u=new Date(t.fechaCreacion);return new Date(d.fechaCreacion).getTime()-u.getTime()}),this.isLoading=!1},error:n=>{this.error="Error cargando pedidos",this.isLoading=!1}})}setPage(n){n>=1&&n<=this.totalPages&&(this.currentPage=n)}traducirEstado(n){return n?{PENDIENTE:"Pendiente",CONFIRMADO:"Confirmado",EN_PREPARACION:"En Preparaci\xF3n",DESPACHADO:"Despachado",ENTREGADO:"Entregado",CANCELADO:"Cancelado"}[n]||n.replace(/_/g," ").replace(/\b\w/g,t=>t.toUpperCase().toLowerCase()):""}obtenerClaseEstado(n){return{PENDIENTE:"badge bg-warning text-dark",CONFIRMADO:"badge bg-info text-white",EN_PREPARACION:"badge bg-warning text-dark",DESPACHADO:"badge bg-warning text-dark",ENTREGADO:"badge bg-success text-white",CANCELADO:"badge bg-danger text-white"}[n]||"badge bg-secondary text-white"}marcarComoListo(n){let e=n.estado;console.log("=== INICIANDO DESPACHO DE PEDIDO ==="),console.log("ID del pedido:",n.id),console.log("Estado actual del pedido:",n.estado),console.log("Pedido completo antes de actualizar:",n),this.pedidoService.actualizarEstadoPedido(n.id,"DESPACHADO").subscribe({next:t=>{console.log("=== DESPACHO EXITOSO ==="),console.log("Respuesta del servidor:",t),n.estado="DESPACHADO",console.log("Estado actualizado en la vista a:",n.estado)},error:t=>{console.error("=== ERROR EN DESPACHO ==="),console.error("Error completo:",t),console.error("Status:",t.status),console.error("Error body:",t.error),console.error("Error message:",t.message),n.estado=e;let d="Error desconocido";t.error&&typeof t.error=="string"?d=t.error:t.error&&t.error.message?d=t.error.message:t.message&&(d=t.message),alert("Error al despachar el pedido: "+d)}})}confirmarRecepcion(n){let e=n.estado;console.log("=== CONFIRMANDO RECEPCI\xD3N ==="),console.log("ID del pedido:",n.id),console.log("Estado actual:",n.estado),this.pedidoService.actualizarEstadoPedido(n.id,"ENTREGADO").subscribe({next:t=>{console.log("=== RECEPCI\xD3N CONFIRMADA ==="),console.log("Respuesta del servidor:",t),n.estado="ENTREGADO",alert("Pedido marcado como entregado exitosamente")},error:t=>{console.error("=== ERROR EN CONFIRMACI\xD3N ==="),console.error("Error completo:",t),n.estado=e;let d="Error desconocido";t.error&&typeof t.error=="string"?d=t.error:t.error&&t.error.message?d=t.error.message:t.message&&(d=t.message),alert("Error al confirmar recepci\xF3n: "+d)}})}static \u0275fac=function(e){return new(e||l)(v(L),v(G))};static \u0275cmp=O({type:l,selectors:[["app-bodega"]],decls:12,vars:5,consts:[["multipleItems",""],[1,"bodega-header"],[1,"bodega-title"],[1,"bodega-subtitle"],[1,"container","mt-4"],["class","text-center my-5",4,"ngIf"],["class","alert alert-danger",4,"ngIf"],[1,"bodega-table-container"],["class","table table-striped table-hover bodega-table",4,"ngIf"],["aria-label","Paginaci\xF3n de pedidos","class","mt-3 mb-4",4,"ngIf"],["class","alert alert-info",4,"ngIf"],[1,"text-center","my-5"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[1,"mt-2"],[1,"alert","alert-danger"],[1,"table","table-striped","table-hover","bodega-table"],[1,"table-dark"],[4,"ngFor","ngForOf"],[4,"ngIf","ngIfElse"],[1,"d-flex","gap-2","justify-content-center"],[1,"btn","btn-icon","btn-outline-primary","btn-sm",3,"click","title","disabled"],[1,"bi","bi-truck"],["title","Confirmar recepci\xF3n",1,"btn","btn-icon","btn-outline-success","btn-sm",3,"click","disabled"],[1,"bi","bi-clipboard-check"],[1,"list-unstyled","mb-0"],["width","32","height","32",1,"me-2","rounded",3,"src","alt"],["type","button","data-bs-toggle","collapse","aria-expanded","false",1,"btn","btn-sm","btn-outline-primary"],[1,"collapse","mt-2",3,"id"],["aria-label","Paginaci\xF3n de pedidos",1,"mt-3","mb-4"],[1,"pagination","justify-content-center"],[1,"page-item"],[1,"page-link",3,"click","disabled"],["class","page-item",3,"active",4,"ngFor","ngForOf"],[1,"page-link",3,"click"],[1,"alert","alert-info"]],template:function(e,t){e&1&&(i(0,"div",1)(1,"h1",2),r(2,"PANEL DE BODEGA"),a(),i(3,"p",3),r(4,"Pedidos en preparaci\xF3n"),a()(),i(5,"div",4),p(6,K,6,0,"div",5)(7,X,2,1,"div",6),i(8,"div",7),p(9,Y,25,1,"table",8)(10,ee,9,8,"nav",9),a(),p(11,te,2,0,"div",10),a()),e&2&&(o(6),s("ngIf",t.isLoading),o(),s("ngIf",t.error),o(2),s("ngIf",!t.isLoading&&t.pagedPedidos.length>0),o(),s("ngIf",!t.isLoading&&t.totalPages>1),o(),s("ngIf",!t.isLoading&&t.pedidos.length===0))},dependencies:[z,M,F,H,j],styles:[".bodega-header[_ngcontent-%COMP%]{text-align:center;margin-top:2.5rem;margin-bottom:2rem;padding:1rem;background:linear-gradient(135deg,#f8f9fa,#e9ecef,#dee2e6);border:2px solid #f7931e;border-radius:12px;box-shadow:0 4px 15px #f7931e33;max-width:600px;margin-left:auto;margin-right:auto}.bodega-title[_ngcontent-%COMP%]{margin:0;font-size:2.2rem;font-weight:600;color:#173856;text-shadow:2px 2px 4px rgba(0,0,0,.3)}.bodega-subtitle[_ngcontent-%COMP%]{font-size:1.05rem;margin:0;color:#6c757d;opacity:.9}.bodega-table-container[_ngcontent-%COMP%]{display:flex;justify-content:center;width:100%;margin-bottom:3rem}.bodega-table[_ngcontent-%COMP%]{min-width:900px;max-width:1100px;margin:0 auto}.bodega-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .bodega-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{text-align:center;vertical-align:middle}.btn-icon[_ngcontent-%COMP%]{width:38px;height:38px;display:inline-flex;align-items:center;justify-content:center;padding:0;border-radius:0!important;font-size:1.2rem;box-shadow:none}"]})};export{U as BodegaComponent};
