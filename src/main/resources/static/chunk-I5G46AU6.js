import{a as j}from"./chunk-I2XG45E3.js";import{b as $}from"./chunk-OV6FUWXQ.js";import{$ as _,$a as A,Ab as T,Ca as h,Ha as I,Ma as p,Sa as w,Sb as R,Ta as d,Tb as F,Ub as L,Va as C,Wa as v,Wb as z,Xa as t,Ya as i,Za as g,_ as b,_a as M,ab as E,bb as x,bc as B,cb as s,db as O,dc as U,hb as N,ib as r,jb as m,kb as f,lb as y,tb as k,va as P,wb as S,xb as V,ya as a,yb as D}from"./chunk-TVOLU7LP.js";var H=()=>[];function K(o,n){o&1&&(t(0,"div",11)(1,"div",12)(2,"span",13),r(3,"Cargando..."),i()(),t(4,"p",14),r(5,"Cargando pedidos..."),i()())}function q(o,n){if(o&1&&(t(0,"div",15),r(1),i()),o&2){let e=s();a(),m(e.error)}}function J(o,n){if(o&1&&(M(0),t(1,"ul",25)(2,"li"),g(3,"img",26),t(4,"strong"),r(5),i(),r(6),g(7,"br"),t(8,"small"),r(9),i()()(),A()),o&2){let e=s().$implicit;a(3),O("alt",e.items[0].nombreProducto),d("src",e.items[0].imagenProducto,P),a(2),m(e.items[0].nombreProducto),a(),f(" (x",e.items[0].cantidad,")"),a(3),f("SKU: ",e.items[0].skuProducto,"")}}function Q(o,n){if(o&1&&(t(0,"li"),g(1,"img",26),t(2,"strong"),r(3),i(),r(4),g(5,"br"),t(6,"small"),r(7),i()()),o&2){let e=n.$implicit;a(),O("alt",e.nombreProducto),d("src",e.imagenProducto,P),a(2),m(e.nombreProducto),a(),f(" (x",e.cantidad,")"),a(3),f("SKU: ",e.skuProducto,"")}}function W(o,n){if(o&1&&(t(0,"button",27),r(1),i(),t(2,"div",28)(3,"ul",25),p(4,Q,8,5,"li",18),i()()),o&2){let e=s().$implicit;w("data-bs-target","#detalleItems"+e.id),a(),f(" Detalle (",e.items.length,") "),a(),d("id","detalleItems"+e.id),a(2),d("ngForOf",e.items)}}function X(o,n){if(o&1){let e=E();t(0,"tr")(1,"td"),r(2),i(),t(3,"td")(4,"span"),r(5),i()(),t(6,"td"),r(7),S(8,"date"),i(),t(9,"td"),r(10),i(),t(11,"td"),r(12),i(),t(13,"td"),r(14),i(),t(15,"td"),r(16),g(17,"br"),r(18),i(),t(19,"td"),r(20),S(21,"conversor"),i(),t(22,"td"),p(23,J,10,5,"ng-container",19)(24,W,5,4,"ng-template",null,0,T),i(),t(26,"td")(27,"div",20)(28,"button",21),x("click",function(){let c=b(e).$implicit,u=s(2);return _(u.prepararPedido(c))}),g(29,"i",22),i(),t(30,"button",23),x("click",function(){let c=b(e).$implicit,u=s(2);return _(u.cancelarPedido(c))}),g(31,"i",24),i()()()()}if(o&2){let e=n.$implicit,l=N(25),c=s(2);a(2),m(e.numeroOrden),a(2),v(c.obtenerClaseEstado(e.estado)),a(),m(c.traducirEstado(e.estado).toUpperCase()),a(2),m(D(8,21,e.fechaCreacion,"short")),a(3),m(e.usuario==null?null:e.usuario.nombre),a(2),m(e.usuario==null?null:e.usuario.email),a(2),m(e.usuario==null?null:e.usuario.telefono),a(2),y(" ",e.direccionEntrega==null?null:e.direccionEntrega.calle," ",e.direccionEntrega==null?null:e.direccionEntrega.numero,""),a(2),y(" ",e.direccionEntrega==null?null:e.direccionEntrega.nombreComuna,", ",e.direccionEntrega==null?null:e.direccionEntrega.nombreRegion," "),a(2),m(V(21,24,e.total)),a(3),d("ngIf",e.items.length===1)("ngIfElse",l),a(5),v(e.estado==="ENTREGADO"?"btn btn-icon btn-secondary btn-sm":"btn btn-icon btn-outline-primary btn-sm"),d("disabled",e.estado==="CANCELADO"||e.estado==="EN_PREPARACION"||e.estado==="ENTREGADO"),a(2),v(e.estado==="ENTREGADO"?"btn btn-icon btn-secondary btn-sm":"btn btn-icon btn-outline-danger btn-sm"),d("disabled",e.estado==="CANCELADO"||e.estado==="ENTREGADO")}}function Y(o,n){if(o&1&&(t(0,"table",16)(1,"thead",17)(2,"tr")(3,"th"),r(4,"N\xB0 Orden"),i(),t(5,"th"),r(6,"Estado"),i(),t(7,"th"),r(8,"Fecha"),i(),t(9,"th"),r(10,"Cliente"),i(),t(11,"th"),r(12,"Email"),i(),t(13,"th"),r(14,"Tel\xE9fono"),i(),t(15,"th"),r(16,"Direcci\xF3n"),i(),t(17,"th"),r(18,"Total"),i(),t(19,"th"),r(20,"Items"),i(),t(21,"th"),r(22,"Acciones"),i()()(),t(23,"tbody"),p(24,X,32,26,"tr",18),i()()),o&2){let e=s();a(24),d("ngForOf",e.pagedPedidos)}}function Z(o,n){if(o&1){let e=E();t(0,"li",31)(1,"button",34),x("click",function(){let c=b(e).index,u=s(2);return _(u.setPage(c+1))}),r(2),i()()}if(o&2){let e=n.index,l=s(2);C("active",l.currentPage===e+1),a(2),m(e+1)}}function ee(o,n){if(o&1){let e=E();t(0,"nav",29)(1,"ul",30)(2,"li",31)(3,"button",32),x("click",function(){b(e);let c=s();return _(c.setPage(c.currentPage-1))}),r(4,"\xAB"),i()(),p(5,Z,3,3,"li",33),t(6,"li",31)(7,"button",32),x("click",function(){b(e);let c=s();return _(c.setPage(c.currentPage+1))}),r(8,"\xBB"),i()()()()}if(o&2){let e=s();a(2),C("disabled",e.currentPage===1),a(),d("disabled",e.currentPage===1),a(2),d("ngForOf",k(7,H).constructor(e.totalPages)),a(),C("disabled",e.currentPage===e.totalPages),a(),d("disabled",e.currentPage===e.totalPages)}}function te(o,n){o&1&&(t(0,"div",35),r(1," No hay pedidos registrados. "),i())}var G=class o{constructor(n,e){this.http=n;this.pedidoService=e}pedidos=[];isLoading=!0;error="";currentPage=1;pageSize=10;get totalPages(){return Math.ceil(this.pedidos.length/this.pageSize)}get pagedPedidos(){let n=(this.currentPage-1)*this.pageSize;return this.pedidos.slice(n,n+this.pageSize)}ngOnInit(){this.http.get(`${U.apiUrl}/pedidos`).subscribe({next:n=>{this.pedidos=n.sort((e,l)=>{let c=new Date(e.fechaCreacion);return new Date(l.fechaCreacion).getTime()-c.getTime()}),this.isLoading=!1},error:n=>{this.error="Error cargando pedidos",this.isLoading=!1}})}setPage(n){n>=1&&n<=this.totalPages&&(this.currentPage=n)}prepararPedido(n){let e=n.estado;this.pedidoService.actualizarEstadoPedido(n.id,"EN_PREPARACION").subscribe({next:()=>{n.estado="EN_PREPARACION"},error:()=>{n.estado=e,alert("Error al actualizar el estado del pedido")}})}cancelarPedido(n){let e=n.estado;this.pedidoService.actualizarEstadoPedido(n.id,"CANCELADO").subscribe({next:()=>{n.estado="CANCELADO"},error:()=>{n.estado=e,alert("Error al cancelar el pedido")}})}traducirEstado(n){return n?{PENDIENTE:"Pendiente",CONFIRMADO:"Confirmado",EN_PREPARACION:"En Preparaci\xF3n",DESPACHADO:"Despachado",ENTREGADO:"Entregado",CANCELADO:"Cancelado"}[n]||n.replace(/_/g," ").replace(/\b\w/g,l=>l.toUpperCase().toLowerCase()):""}obtenerClaseEstado(n){return{PENDIENTE:"badge bg-warning text-dark",CONFIRMADO:"badge bg-info text-white",EN_PREPARACION:"badge bg-warning text-dark",DESPACHADO:"badge bg-warning text-dark",ENTREGADO:"badge bg-success text-white",CANCELADO:"badge bg-danger text-white"}[n]||"badge bg-secondary text-white"}static \u0275fac=function(e){return new(e||o)(h(B),h(j))};static \u0275cmp=I({type:o,selectors:[["app-ventas"]],decls:12,vars:5,consts:[["multipleItems",""],[1,"ventas-header"],[1,"ventas-title"],[1,"ventas-subtitle"],[1,"container","mt-4"],["class","text-center my-5",4,"ngIf"],["class","alert alert-danger",4,"ngIf"],[1,"ventas-table-container"],["class","table table-striped table-hover ventas-table",4,"ngIf"],["aria-label","Paginaci\xF3n de pedidos","class","mt-3 mb-4",4,"ngIf"],["class","alert alert-info",4,"ngIf"],[1,"text-center","my-5"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[1,"mt-2"],[1,"alert","alert-danger"],[1,"table","table-striped","table-hover","ventas-table"],[1,"table-dark"],[4,"ngFor","ngForOf"],[4,"ngIf","ngIfElse"],[1,"d-flex","gap-2","justify-content-center"],["title","Preparar pedido",3,"click","disabled"],[1,"bi","bi-box-seam"],["title","Cancelar pedido",3,"click","disabled"],[1,"bi","bi-slash-circle"],[1,"list-unstyled","mb-0"],["width","32","height","32",1,"me-2","rounded",3,"src","alt"],["type","button","data-bs-toggle","collapse","aria-expanded","false",1,"btn","btn-sm","btn-outline-primary"],[1,"collapse","mt-2",3,"id"],["aria-label","Paginaci\xF3n de pedidos",1,"mt-3","mb-4"],[1,"pagination","justify-content-center"],[1,"page-item"],[1,"page-link",3,"click","disabled"],["class","page-item",3,"active",4,"ngFor","ngForOf"],[1,"page-link",3,"click"],[1,"alert","alert-info"]],template:function(e,l){e&1&&(t(0,"div",1)(1,"h1",2),r(2,"Panel de Ventas"),i(),t(3,"p",3),r(4,"Listado de pedidos registrados"),i()(),t(5,"div",4),p(6,K,6,0,"div",5)(7,q,2,1,"div",6),t(8,"div",7),p(9,Y,25,1,"table",8)(10,ee,9,8,"nav",9),i(),p(11,te,2,0,"div",10),i()),e&2&&(a(6),d("ngIf",l.isLoading),a(),d("ngIf",l.error),a(2),d("ngIf",!l.isLoading&&l.pagedPedidos.length>0),a(),d("ngIf",!l.isLoading&&l.totalPages>1),a(),d("ngIf",!l.isLoading&&l.pedidos.length===0))},dependencies:[z,R,F,L,$],styles:[".container[_ngcontent-%COMP%]{max-width:1200px}h2[_ngcontent-%COMP%]{font-weight:600}table[_ngcontent-%COMP%]{font-size:.95rem}thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{text-align:center;vertical-align:middle}td[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{padding-left:0}img.me-2[_ngcontent-%COMP%]{vertical-align:middle}.badge[_ngcontent-%COMP%]{font-size:.9em}.ventas-header[_ngcontent-%COMP%]{text-align:center;margin-top:2.5rem;margin-bottom:2rem;padding:1rem;background:linear-gradient(135deg,#f8f9fa,#e9ecef,#dee2e6);border:2px solid #f7931e;border-radius:12px;box-shadow:0 4px 15px #f7931e33;max-width:600px;margin-left:auto;margin-right:auto}.ventas-title[_ngcontent-%COMP%]{margin:0;font-size:2.2rem;font-weight:600;color:#173856;text-shadow:2px 2px 4px rgba(0,0,0,.3)}.ventas-subtitle[_ngcontent-%COMP%]{font-size:1.05rem;margin:0;color:#6c757d;opacity:.9}.ventas-table-container[_ngcontent-%COMP%]{display:flex;justify-content:center;width:100%;margin-bottom:3rem}.ventas-table[_ngcontent-%COMP%]{min-width:900px;max-width:1100px;margin:0 auto}.btn-icon[_ngcontent-%COMP%]{width:38px;height:38px;display:inline-flex;align-items:center;justify-content:center;padding:0;border-radius:0!important;font-size:1.2rem;box-shadow:none}.btn-outline-warning[_ngcontent-%COMP%]{border-color:#ffc107;color:#ffc107;background:transparent}.btn-outline-warning[_ngcontent-%COMP%]:hover, .btn-outline-warning[_ngcontent-%COMP%]:focus{background:#fff8e1;color:#856404}.btn-outline-danger[_ngcontent-%COMP%]{border-color:#dc3545;color:#dc3545;background:transparent}.btn-outline-danger[_ngcontent-%COMP%]:hover, .btn-outline-danger[_ngcontent-%COMP%]:focus{background:#f8d7da;color:#721c24}.btn-outline-success[_ngcontent-%COMP%]{border-color:#28a745;color:#28a745;background:transparent}.btn-outline-success[_ngcontent-%COMP%]:hover, .btn-outline-success[_ngcontent-%COMP%]:focus{background:#e6f4ea;color:#155724}.btn-secondary[_ngcontent-%COMP%]{background-color:#6c757d;border-color:#6c757d;color:#fff;opacity:.6;cursor:not-allowed}.btn-secondary[_ngcontent-%COMP%]:hover, .btn-secondary[_ngcontent-%COMP%]:focus, .btn-secondary[_ngcontent-%COMP%]:disabled{background-color:#6c757d;border-color:#6c757d;color:#fff;opacity:.6;cursor:not-allowed;transform:none;box-shadow:none}.btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed;transform:none;box-shadow:none}.btn[_ngcontent-%COMP%]:disabled:hover{transform:none;box-shadow:none}"]})};export{G as VentasComponent};
